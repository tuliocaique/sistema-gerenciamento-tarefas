async function getToken(){let a=null;try{return(a=await $.ajax({type:"GET",url:"api/token",dataType:"json"})).refreshToken}catch(a){$(location).attr("href","login")}}async function getTarefas(a){$.ajax({type:"GET",url:"api/tarefa",dataType:"json",beforeSend:function(e){e.setRequestHeader("Authorization","Bearer "+a)},success:function(a){a.success?$.each(a.tarefas,function(a,e){let t='<span class="badge badge-success">Ativa</span>';"0"===e.status&&(t='<span class="badge badge-secondary">Inativa</span>'),$("#listagemTarefas").append('<li class="list-group-item p-4">\n                            <h4 class="font-weight-bold">'+e.titulo+"</h4>\n                            <p>"+e.descricao+'</p>\n                            <p class="text-muted text-uppercase">'+t+" Inicio: "+e.dataInicio+" | Fim: "+e.dataFim+'</p>\n                            <button class="btn btn-sm btn-primary btn-rounded pl-3 pr-3" data-toggle="model" data-target="#modalAlterarTarefa" data-cod="'+e.cod+'" onclick="gerenciarTarefa(this.getAttribute(\'data-cod\'), \'editar\')"><i class="fas fa-edit"></i> Editar</button>\n                            <button class="btn btn-sm btn-danger btn-rounded pl-3 pr-3" data-cod="'+e.cod+'" onclick="gerenciarTarefa(this.getAttribute(\'data-cod\'), \'apagar\')"><i class="fas fa-trash"></i> Apagar</button>\n                        </li>')}):$("#listagemTarefas").append('<li class="list-group-item">'+a.message+"</li>")},error:function(a,e,t){}})}async function gerenciarTarefa(a,e){"editar"===e?getToken().then(e=>getDadosTarefa(e,a)):"apagar"===e&&getToken().then(e=>deletarTarefa(e,a))}async function getDadosTarefa(a,e){$.ajax({type:"GET",url:"api/tarefa",data:{cod:e},contentType:"application/json",dataType:"json",beforeSend:function(e){e.setRequestHeader("Authorization","Bearer "+a)},success:function(a){a.success?($("#codAlterar").val(e),$("#tituloTarefaAlterar").val(a.tarefa.titulo),$("#descricaoTarefaAlterar").val(a.tarefa.descricao),$("#dataInicioTarefaAlterar").val(new Date(a.tarefa.dataInicio).toJSON().slice(0,19)),$("#dataFimTarefaAlterar").val(new Date(a.tarefa.dataFim).toJSON().slice(0,19)),"1"===a.tarefa.status&&$("#statusTarefaAlterar").prop("checked",!0)):toastr.error(a.message)},error:function(a){toastr.error(a)}})}async function cadastrarTarefa(a){let e=$("#btn-cadastrar-tarefa"),t=$("#cadastrarTarefa").serialize();$.ajax({type:"POST",url:"api/tarefa",data:t,contentType:"application/json",dataType:"json",beforeSend:function(t){t.setRequestHeader("Authorization","Bearer "+a),e.addClass("disabled"),e.html('<div class="spinner-border text-light" role="status"><span class="sr-only">Loading...</span></div> <span>Deletando</span>')},success:function(a){a.success?(toastr.success(a.message),$("#modalCadastrarTarefa").modal("toggle"),$("#cadastrarTarefa").trigger("reset"),$("#listagemTarefas").empty(),getToken().then(a=>getTarefas(a))):(console.error(a),toastr.error(a.message))},error:function(a){console.error(a),toastr.error(a)},complete:function(){e.removeClass("disabled"),e.html("Cadastrar")}})}async function alterarTarefa(a){let e=$("#alterarTarefa").serialize(),t=$("#btn-alterar-tarefa");$.ajax({type:"PUT",url:"api/tarefa",data:e,contentType:"application/json",dataType:"json",beforeSend:function(e){e.setRequestHeader("Authorization","Bearer "+a),t.addClass("disabled"),t.html('<div class="spinner-border text-light" role="status"><span class="sr-only">Loading...</span></div> <span>Alterando...</span>')},success:function(a){toastr.success(a.message),$("#modalAlterarTarefa").modal("toggle"),$("#alterarTarefa").trigger("reset"),$("#listagemTarefas").empty(),getToken().then(a=>getTarefas(a))},error:function(a){toastr.error(a)},complete:function(){t.removeClass("disabled"),t.html("Alterar")}})}async function deletarTarefa(a,e){$.ajax({type:"DELETE",url:"api/tarefa",data:{cod:e},contentType:"application/json",dataType:"json",beforeSend:function(e){e.setRequestHeader("Authorization","Bearer "+a)},success:function(a){a.success?(toastr.success(a.message),$("#listagemTarefas").empty(),getToken().then(a=>getTarefas(a))):toastr.error(a.message)},error:function(a){toastr.error(a)}})}async function iniciarTarefa(a){await getTarefas(a)}$(document).ready(function(){getToken().then(a=>iniciarTarefa(a)),$("#cadastrarTarefa").submit(function(a){getToken().then(a=>cadastrarTarefa(a)),a.preventDefault()}),$("#alterarTarefa").submit(function(a){getToken().then(a=>alterarTarefa(a)),a.preventDefault()})});